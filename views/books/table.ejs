<a href="/" class="back-link">‚Üê Back to Main Menu</a>
<h1>üìö Library Books Database</h1>

<!-- Search Bar -->
<div class="search-container">
    <div class="search-title">
        üîç Search & Sort Books
    </div>
    <form class="search-form" method="GET" action="/table">
        <div class="search-group">
            <label for="search">Search Term</label>
            <input type="text" id="search" name="search" class="search-input"
                placeholder="Enter book title, author, or ID..." value="<%= search || '' %>">
        </div>

        <div class="search-group">
            <label for="searchBy">Search In</label>
            <select id="searchBy" name="searchBy" class="search-select">
                <option value="">All Fields</option>
                <option value="title" <%=searchBy==='title' ? 'selected' : '' %>>Title Only</option>
                <option value="id" <%=searchBy==='id' ? 'selected' : '' %>>ID Only</option>
            </select>
        </div>

        <div class="search-group">
            <label for="genre">Filter by Genre</label>
            <select id="genre" name="genre" class="search-select">
                <option value="">All Genres</option>
                <% if (typeof allGenres !=='undefined' && allGenres) { %>
                    <% allGenres.forEach(function(g) { %>
                        <option value="<%= g %>" <%=genre===g ? 'selected' : '' %>><%= g %>
                        </option>
                        <% }); %>
                            <% } %>
            </select>
        </div>

        <div class="search-group">
            <label for="sortBy">Sort By</label>
            <select id="sortBy" name="sortBy" class="search-select">
                <option value="">Default (Author, Title)</option>
                <option value="id" <%=sortBy==='id' ? 'selected' : '' %>>ID (Chronological)</option>
                <option value="title" <%=sortBy==='title' ? 'selected' : '' %>>Title (Alphabetical)</option>
                <option value="author" <%=sortBy==='author' ? 'selected' : '' %>>Author (Alphabetical)</option>
                <option value="genre" <%=sortBy==='genre' ? 'selected' : '' %>>Genre</option>
                <option value="publicationYear" <%=sortBy==='publicationYear' ? 'selected' : '' %>>Publication Year
                </option>
            </select>
        </div>

        <div class="search-group">
            <label for="sortOrder">Order</label>
            <select id="sortOrder" name="sortOrder" class="search-select">
                <option value="asc" <%=sortOrder !=='desc' ? 'selected' : '' %>>Ascending (A-Z, 1-9)</option>
                <option value="desc" <%=sortOrder==='desc' ? 'selected' : '' %>>Descending (Z-A, 9-1)</option>
            </select>
        </div>

        <button type="submit" class="search-btn">üîç Search</button>
        <a href="/table" class="clear-btn">üîÑ Clear</a>
    </form>

    <% if (searchMessage) { %>
        <div class="search-message">üìä <%= searchMessage %> ‚Ä¢ Found <%= books.length %> result(s)</div>
        <% } %>
</div>

<div class="book-count">
    <%= searchMessage ? `Showing ${books.length} filtered results` : `Total books: ${books.length}` %>
</div>
<a href="/add-book" class="add-book-btn">‚ûï Add New Book</a>

<table>
    <thead>
        <tr>
            <th>ID</th>
            <th>Author</th>
            <th>Title</th>
            <th>ISBN</th>
            <th>Genre</th>
            <th>Publication Year</th>
            <th>Description</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        <% books.forEach(function(book) { %>
            <tr class="book-row" data-book-id="<%= book.ID %>" onclick="viewBookDetails('<%= book.ID %>')">
                <td>
                    <%= book.ID %>
                </td>
                <td>
                    <%= book.Author %>
                </td>
                <td>
                    <%= book.Title %>
                </td>
                <td>
                    <%= book.ISBN || '' %>
                </td>
                <td>
                    <%= book.Genre || '' %>
                </td>
                <td>
                    <%= book.PublicationYear || '' %>
                </td>
                <td title="<%= book.Description || '' %>">
                    <%= book.Description ? (book.Description.length> 50 ? book.Description.substring(0, 50) + '...' :
                        book.Description) : '' %>
                </td>
                <td><a href="/edit/<%= book.ID %>" class="edit-btn" onclick="event.stopPropagation()">Edit</a></td>
            </tr>
            <% }); %>
    </tbody>
</table>

<% if (books.length===0) { %>
    <div class="no-results">
        <h3>üì≠ No books found</h3>
        <p>Try adjusting your search criteria or <a href="/table">clear all filters</a>.</p>
    </div>
    <% } %>

        <style>
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                margin: 20px;
                background-color: #f5f5f5;
            }

            .container {
                max-width: 1400px;
                margin: 0 auto;
                background-color: white;
                padding: 20px;
                border-radius: 8px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }

            h1 {
                color: #333;
                text-align: center;
                margin-bottom: 30px;
            }

            /* Search Bar Styles */
            .search-container {
                background-color: #f8f9fa;
                padding: 20px;
                border-radius: 8px;
                margin-bottom: 20px;
                border: 1px solid #dee2e6;
            }

            .search-title {
                font-size: 1.2em;
                font-weight: bold;
                color: #495057;
                margin-bottom: 15px;
                display: flex;
                align-items: center;
                gap: 8px;
            }

            .search-form {
                display: grid;
                grid-template-columns: 1fr auto auto auto auto auto;
                gap: 15px;
                align-items: end;
            }

            .search-group {
                display: flex;
                flex-direction: column;
                gap: 5px;
            }

            .search-group label {
                font-weight: 500;
                color: #6c757d;
                font-size: 0.9em;
            }

            .search-input,
            .search-select {
                padding: 8px 12px;
                border: 1px solid #ced4da;
                border-radius: 4px;
                font-size: 14px;
                background-color: white;
            }

            .search-input:focus,
            .search-select:focus {
                outline: none;
                border-color: #007bff;
                box-shadow: 0 0 0 2px rgba(0, 123, 255, .25);
            }

            .search-btn,
            .clear-btn {
                padding: 8px 16px;
                border: none;
                border-radius: 4px;
                font-size: 14px;
                cursor: pointer;
                text-decoration: none;
                display: inline-block;
                text-align: center;
                transition: all 0.3s;
                white-space: nowrap;
            }

            .search-btn {
                background-color: #007bff;
                color: white;
            }

            .search-btn:hover {
                background-color: #0056b3;
            }

            .clear-btn {
                background-color: #6c757d;
                color: white;
            }

            .clear-btn:hover {
                background-color: #5a6268;
            }

            .search-message {
                margin-top: 10px;
                padding: 8px;
                background-color: #d1ecf1;
                color: #0c5460;
                border-radius: 4px;
                font-size: 0.9em;
            }

            /* Responsive search form */
            @media (max-width: 768px) {
                .search-form {
                    grid-template-columns: 1fr;
                    gap: 10px;
                }

                .search-btn,
                .clear-btn {
                    width: 100%;
                }
            }

            table {
                width: 100%;
                border-collapse: collapse;
                margin-top: 20px;
            }

            th,
            td {
                padding: 12px;
                text-align: left;
                border-bottom: 1px solid #ddd;
            }

            th {
                background-color: #f8f9fa;
                font-weight: bold;
                color: #495057;
                border-top: 2px solid #007bff;
            }

            tr:hover {
                background-color: #f8f9fa;
            }

            .book-row {
                cursor: pointer;
                transition: background-color 0.2s, transform 0.1s;
            }

            .book-row:hover {
                background-color: #e3f2fd !important;
                transform: translateY(-1px);
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }

            .edit-btn {
                background-color: #007bff;
                color: white;
                padding: 6px 12px;
                text-decoration: none;
                border-radius: 4px;
                font-size: 0.9em;
                transition: background-color 0.3s;
            }

            .edit-btn:hover {
                background-color: #0056b3;
            }

            .add-book-btn {
                background-color: #28a745;
                color: white;
                padding: 10px 20px;
                text-decoration: none;
                border-radius: 4px;
                font-size: 1em;
                font-weight: bold;
                transition: background-color 0.3s;
                display: inline-block;
                margin-bottom: 20px;
            }

            .add-book-btn:hover {
                background-color: #1e7e34;
            }

            .book-count {
                margin-bottom: 10px;
                color: #666;
                font-style: italic;
            }

            .back-link {
                display: inline-block;
                margin-bottom: 20px;
                color: #007bff;
                text-decoration: none;
                padding: 8px 16px;
                border: 1px solid #007bff;
                border-radius: 4px;
                transition: all 0.3s;
            }

            .back-link:hover {
                background-color: #007bff;
                color: white;
            }

            .no-results {
                text-align: center;
                padding: 40px;
                color: #6c757d;
                font-style: italic;
            }

            .no-results h3 {
                margin-bottom: 10px;
            }

            .no-results p {
                margin: 0;
            }

            .no-results a {
                color: #007bff;
                text-decoration: none;
            }

            .no-results a:hover {
                text-decoration: underline;
            }
        </style>

        <script>
            function viewBookDetails(bookId) {
                window.location.href = '/book/' + encodeURIComponent(bookId);
            }

            // Add visual feedback for clickable rows
            document.addEventListener('DOMContentLoaded', function () {
                const bookRows = document.querySelectorAll('.book-row');
                bookRows.forEach(row => {
                    row.addEventListener('mouseenter', function () {
                        this.style.cursor = 'pointer';
                    });
                });
            });
            // Prevent row click when clicking on the Edit button
        </script>