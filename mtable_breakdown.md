# Library Member Management System - Implementation Breakdown

## üìã Project Overview
Transform the existing library management system to support member authentication, role-based access control, and member-specific functionality while maintaining the current admin interface.

## üéØ Core Requirements
- **Login/register page** for admins and members
- **Admin interface** uses current website (enhanced)
- **Member interface** is simplified (browse, borrow, return only)
- **3-book borrowing limit** for members
- **Members table** for admin management
- **Book selection workflow** for members
- **Member-tracked borrowing** system

---

## üîß Implementation Steps

### **Step 1: Create Member Authentication System** 
**Status:** ‚úÖ Completed  
**Priority:** High  
**Dependencies:** None

#### Tasks:
- [ ] Create `Member` model in `src/models/Member.ts`
- [ ] Build authentication middleware for role-based access
- [ ] Create login/register forms with validation
- [ ] Implement password hashing and session management
- [ ] Add authentication routes (`/login`, `/register`, `/logout`)

#### Files to Create/Modify:
- `src/models/Member.ts` - Member data model
- `src/middleware/auth.ts` - Authentication middleware
- `src/controllers/AuthController.ts` - Login/register logic
- `src/routes/authRoutes.ts` - Authentication routes
- `views/auth/login.ejs` - Login form
- `views/auth/register.ejs` - Registration form

---

### **Step 2: Create Members Database Schema**
**Status:** ‚úÖ Completed  
**Priority:** High  
**Dependencies:** None

#### Tasks:
- [ ] Design members table schema
- [ ] Create migration script for members table
- [ ] Add member seed data for testing
- [ ] Update database initialization

#### Database Schema:
```sql
CREATE TABLE members (
    MemberID TEXT PRIMARY KEY,
    Name TEXT NOT NULL,
    Email TEXT UNIQUE NOT NULL,
    Password TEXT NOT NULL,
    Role TEXT CHECK(Role IN ('admin', 'member')) DEFAULT 'member',
    CreatedAt DATETIME DEFAULT CURRENT_TIMESTAMP,
    UpdatedAt DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

#### Files to Create/Modify:
- `migrations/04-create-members-table.sql` - Members table migration
- `seed/members-seed.sql` - Test member data
- Update `src/services/DatabaseService.ts` - Include members table

---

### **Step 3: Build Member Management for Admins**
**Status:** ‚úÖ Completed  
**Priority:** Medium  
**Dependencies:** Steps 1, 2

#### Tasks:
- [x] Add members table view to admin interface
- [x] Implement CRUD operations for members
- [x] Add member borrowing history view (placeholder for future borrowing system)
- [x] Integrate with existing admin layout

#### Files to Create/Modify:
- `src/controllers/MemberController.ts` - Member management logic
- `src/services/MemberService.ts` - Member business logic
- `src/repositories/SQLiteMemberRepository.ts` - Member data access
- `views/members/table.ejs` - Members table view
- `views/members/edit.ejs` - Edit member form
- `views/members/add.ejs` - Add member form
- Update `src/routes/mainRoutes.ts` - Add member routes

---

### **Step 4: Create Simple Member Interface**
**Status:** ‚úÖ Completed  
**Priority:** High  
**Dependencies:** Steps 1, 2

#### Tasks:
- [x] Design simplified member layout
- [x] Create member dashboard
- [x] Build book browsing interface for members
- [x] Add member-specific navigation

#### Files to Create/Modify:
- `views/layouts/member-layout.ejs` - Member interface layout
- `views/member/dashboard.ejs` - Member dashboard
- `views/member/books.ejs` - Simplified book browsing
- `src/controllers/MemberDashboardController.ts` - Member interface logic
- `src/routes/memberRoutes.ts` - Member-specific routes

---

### **Step 5: Implement Member Book Borrowing System**
**Status:** ‚úÖ Completed  
**Priority:** High  
**Dependencies:** Steps 1, 2, 4

#### Tasks:
- [x] Create book selection workflow for members
- [x] Implement 3-book borrowing limit
- [x] Add borrowing confirmation process
- [x] Integrate member authentication with borrowing

#### Files Created/Modified:
- Updated `src/services/BookService.ts` - Added member borrowing logic with 3-book limit enforcement
- Updated `src/repositories/SQLiteBookRepository.ts` - Added member borrowing queries and database operations
- Updated `views/member/book-details.ejs` - Added borrowing button and confirmation process
- Updated `views/member/borrowed-books.ejs` - Added real borrowed books display with return functionality
- Updated `src/controllers/MemberDashboardController.ts` - Implemented real borrowing functionality and API endpoints
- Updated `src/routes/memberDashboardRoutes.ts` - Added POST routes for borrowing and returning books

#### Implementation Details:
- **3-Book Limit**: System enforces maximum 3 concurrent book borrowings per member
- **Book Availability**: Real-time checking of available copies before allowing borrowing
- **Borrowing Workflow**: Members can borrow books directly from book details page with confirmation
- **Return Functionality**: One-click return from borrowed books dashboard
- **Due Date Tracking**: 14-day loan period with overdue notifications
- **Error Handling**: Comprehensive error messages for various borrowing scenarios
- **Database Integration**: Full integration with borrowings table and member tracking

---

### **Step 6: Build Member Borrowed Books Dashboard**
**Status:** Not Started  
**Priority:** Medium  
**Dependencies:** Steps 1, 2, 5

#### Tasks:
- [ ] Create borrowed books view for members
- [ ] Add due date tracking
- [ ] Implement one-click return functionality
- [ ] Show borrowing history

#### Files to Create/Modify:
- `views/member/borrowed-books.ejs` - Borrowed books dashboard
- Update `src/controllers/MemberDashboardController.ts` - Borrowed books logic
- Update `src/services/BookService.ts` - Member return functionality

---

### **Step 7: Update Book Borrowing with Member Integration**
**Status:** Not Started  
**Priority:** High  
**Dependencies:** Steps 1, 2

#### Tasks:
- [ ] Modify copies table to include MemberID
- [ ] Update existing borrowing system for member tracking
- [ ] Enforce member borrowing rules
- [ ] Update book statistics to show member info

#### Database Changes:
```sql
ALTER TABLE copies ADD COLUMN MemberID TEXT;
ALTER TABLE copies ADD COLUMN BorrowedDate DATETIME;
ALTER TABLE copies ADD COLUMN DueDate DATETIME;
```

#### Files to Modify:
- `migrations/05-add-member-to-copies.sql` - Add member fields to copies
- Update `src/repositories/SQLiteBookRepository.ts` - Member borrowing queries
- Update `src/services/BookService.ts` - Member borrowing rules
- Update `views/books/table.ejs` - Show member info in admin view

---

### **Step 8: Implement Role-Based Access Control**
**Status:** Not Started  
**Priority:** High  
**Dependencies:** Step 1

#### Tasks:
- [ ] Create middleware to protect admin routes
- [ ] Add role-based redirects
- [ ] Ensure members can only access member features
- [ ] Add unauthorized access handling

#### Files to Create/Modify:
- `src/middleware/adminAuth.ts` - Admin-only middleware
- `src/middleware/memberAuth.ts` - Member authentication middleware
- Update all admin routes with protection
- Update `src/routes/index.ts` - Role-based routing

---

### **Step 9: Create Member Registration Workflow**
**Status:** Not Started  
**Priority:** Low  
**Dependencies:** Steps 1, 2

#### Tasks:
- [ ] Build self-registration process
- [ ] Add email validation
- [ ] Implement password requirements
- [ ] Create admin approval system (optional)

#### Files to Create/Modify:
- Update `views/auth/register.ejs` - Enhanced registration form
- Update `src/controllers/AuthController.ts` - Registration validation
- `src/services/EmailService.ts` - Welcome email functionality (optional)

---

### **Step 10: Test and Validate Complete System**
**Status:** Not Started  
**Priority:** Medium  
**Dependencies:** All previous steps

#### Tasks:
- [ ] Test admin/member authentication flows
- [ ] Validate borrowing limits and restrictions
- [ ] Test all CRUD operations
- [ ] Ensure proper error handling
- [ ] User experience testing across interfaces

#### Testing Areas:
- Authentication and authorization
- Member registration and login
- Book borrowing workflows
- Admin member management
- Role-based access control
- Database integrity
- UI/UX consistency

---

## üèóÔ∏è Implementation Strategy

### **Phase 1: Foundation (Steps 1-2)**
Set up the core authentication system and database schema. This provides the foundation for all other features.

### **Phase 2: Admin Features (Steps 3, 8)**
Extend the existing admin interface to manage members and implement proper access controls.

### **Phase 3: Member Experience (Steps 4-6)**
Build the simplified member interface and borrowing workflows.

### **Phase 4: Integration & Testing (Steps 7, 9-10)**
Connect all systems, add advanced features, and thoroughly test the complete solution.

---

## üìÅ Project Structure After Implementation

```
src/
‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îú‚îÄ‚îÄ AuthController.ts           # New - Authentication
‚îÇ   ‚îú‚îÄ‚îÄ MemberController.ts         # New - Member management
‚îÇ   ‚îú‚îÄ‚îÄ MemberDashboardController.ts # New - Member interface
‚îÇ   ‚îî‚îÄ‚îÄ MainController.ts           # Modified - Admin interface
‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îú‚îÄ‚îÄ auth.ts                     # New - General authentication
‚îÇ   ‚îú‚îÄ‚îÄ adminAuth.ts                # New - Admin protection
‚îÇ   ‚îî‚îÄ‚îÄ memberAuth.ts               # New - Member authentication
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ Member.ts                   # New - Member data model
‚îÇ   ‚îî‚îÄ‚îÄ Book.ts                     # Existing
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ MemberService.ts            # New - Member business logic
‚îÇ   ‚îú‚îÄ‚îÄ BookService.ts              # Modified - Member integration
‚îÇ   ‚îî‚îÄ‚îÄ DatabaseService.ts          # Modified - Members table
‚îú‚îÄ‚îÄ repositories/
‚îÇ   ‚îú‚îÄ‚îÄ SQLiteMemberRepository.ts   # New - Member data access
‚îÇ   ‚îî‚îÄ‚îÄ SQLiteBookRepository.ts     # Modified - Member borrowing
‚îî‚îÄ‚îÄ routes/
    ‚îú‚îÄ‚îÄ authRoutes.ts               # New - Authentication routes
    ‚îú‚îÄ‚îÄ memberRoutes.ts             # New - Member interface routes
    ‚îî‚îÄ‚îÄ mainRoutes.ts               # Modified - Admin routes

views/
‚îú‚îÄ‚îÄ auth/
‚îÇ   ‚îú‚îÄ‚îÄ login.ejs                   # New - Login form
‚îÇ   ‚îî‚îÄ‚îÄ register.ejs                # New - Registration form
‚îú‚îÄ‚îÄ layouts/
‚îÇ   ‚îî‚îÄ‚îÄ member-layout.ejs           # New - Member interface layout
‚îú‚îÄ‚îÄ member/
‚îÇ   ‚îú‚îÄ‚îÄ dashboard.ejs               # New - Member dashboard
‚îÇ   ‚îú‚îÄ‚îÄ books.ejs                   # New - Member book browsing
‚îÇ   ‚îú‚îÄ‚îÄ borrowed-books.ejs          # New - Borrowed books view
‚îÇ   ‚îî‚îÄ‚îÄ borrow-book.ejs             # New - Book borrowing form
‚îú‚îÄ‚îÄ members/
‚îÇ   ‚îú‚îÄ‚îÄ table.ejs                   # New - Admin members table
‚îÇ   ‚îú‚îÄ‚îÄ add.ejs                     # New - Add member form
‚îÇ   ‚îî‚îÄ‚îÄ edit.ejs                    # New - Edit member form
‚îî‚îÄ‚îÄ books/
    ‚îî‚îÄ‚îÄ table.ejs                   # Modified - Show member info

migrations/
‚îú‚îÄ‚îÄ 04-create-members-table.sql     # New - Members table
‚îî‚îÄ‚îÄ 05-add-member-to-copies.sql     # New - Member tracking in copies

seed/
‚îî‚îÄ‚îÄ members-seed.sql                # New - Test member data
```

---

## üîÑ Architecture Compliance

This implementation maintains the established **three-tier architecture**:

- **Presentation Layer**: Controllers handle HTTP requests/responses
- **Business Logic Layer**: Services contain business rules and validation
- **Data Access Layer**: Repositories manage database operations

All new components follow the existing patterns and integrate seamlessly with the current codebase.

## ‚úÖ Success Criteria

- [ ] Admins can manage members through the existing interface
- [ ] Members can register, login, and access simplified interface
- [ ] Members can browse books and borrow up to 3 at a time
- [ ] Members can view borrowed books and return them
- [ ] Role-based access control protects admin features
- [ ] All existing admin functionality is preserved
- [ ] System maintains data integrity and proper error handling


